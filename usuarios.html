<!DOCTYPE html>
<html lang="pt-br" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Gest√£o de Usu√°rios</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px 15px;
      color: #333;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 720px;
      background: #fff;
      padding: 25px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(79, 70, 229, 0.15);
      display: flex;
      flex-direction: column;
      gap: 25px;
      box-sizing: border-box;
    }

    #btnVoltar {
      background: transparent;
      border: none;
      color: #4f46e5;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      padding: 8px 0;
      margin-bottom: 20px;
      align-self: flex-start;
      transition: color 0.3s ease;
    }
    #btnVoltar:hover {
      color: #372fda;
      text-decoration: underline;
    }

    h1 {
      margin: 0 0 10px;
      color: #4f46e5;
      font-weight: 700;
      font-size: 2.2rem;
      text-align: center;
      word-break: break-word;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #555;
    }

    input[type="text"], input[type="password"], select {
      padding: 12px 15px;
      border: 1.8px solid #ddd;
      border-radius: 12px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      width: 100%;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      border-color: #4f46e5;
      outline: none;
    }

    .senha-wrapper {
      position: relative;
      width: 100%;
    }
    .senha-wrapper input { padding-right: 42px; }
    .toggle-olhinho-btn {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.4rem;
      color: #4f46e5;
      padding: 0;
      line-height: 1;
      user-select: none;
    }
    .toggle-olhinho-btn:focus {
      outline: 2px solid #4f46e5;
      outline-offset: 2px;
    }

    button[type="submit"] {
      background: #4f46e5;
      color: white;
      padding: 14px 20px;
      font-weight: 700;
      font-size: 1.1rem;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4);
      transition: background 0.3s ease, transform 0.2s ease;
      width: 100%;
      max-width: 300px;
      align-self: center;
    }

    button[type="submit"]:hover {
      background: #4338ca;
      transform: translateY(-2px);
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 12px;
      font-size: 0.95rem;
      color: #444;
      table-layout: fixed;
      word-wrap: break-word;
    }

    th {
      background: #4f46e5;
      color: white;
      padding: 14px 15px;
      text-align: left;
      border-radius: 12px 12px 0 0;
      user-select: none;
    }

    tbody tr {
      background: #fafafa;
      border-radius: 12px;
      transition: background 0.3s ease;
    }
    tbody tr:hover { background: #e9ecff; }

    td {
      padding: 14px 15px;
      overflow-wrap: break-word;
    }
    td:first-child {
      font-weight: 600;
      color: #2c2c2c;
      max-width: 150px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .actions-cell {
      white-space: nowrap;
      width: 130px;
    }

    button.edit-btn, button.delete-btn, button.view-pass-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 20px;
      margin-right: 12px;
      border-radius: 8px;
      padding: 6px 10px;
      color: #4f46e5;
      transition: background 0.3s ease;
    }
    button.edit-btn:hover { background: #c7d3ff; }
    button.delete-btn:hover { background: #fbb6b6; color: #b91c1c; }
    button.view-pass-btn:hover { background: #c7d3ff; }

    /* Modais com estilo aprimorado e responsivo */
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    #modalSenha, #modalMensagem, #modalConfirm {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 10000;
      padding: 15px;
      box-sizing: border-box;
    }

    .modal-content {
      background: #fff;
      padding: 25px 20px 30px;
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
      text-align: center;
      font-size: 1.05rem;
      font-weight: 500;
      color: #2c2c2c;
      animation: fadeInScale 0.3s ease;
      box-sizing: border-box;
      word-wrap: break-word;
    }

    #modalSenha .modal-content::before { content: "\1F512"; }
    #modalMensagem .modal-content::before { content: "\1F4A1"; }
    #modalConfirm .modal-content::before { content: "\2753"; }
    .modal-content::before {
      font-size: 2.5rem;
      display: block;
      margin-bottom: 12px;
      color: #4f46e5;
      user-select: none;
    }

    .modal-content button {
      background: #4f46e5;
      color: white;
      padding: 12px 18px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1rem;
      margin: 10px 5px 0;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      min-width: 100px;
    }

    #modalConfirm #btnSim {
      background: #22c55e;
    }
    #modalConfirm #btnSim:hover {
      background: #16a34a;
    }
    #modalConfirm #btnNao {
      background: #ef4444;
      color: white;
    }
    #modalConfirm #btnNao:hover {
      background: #dc2626;
    }

    .modal-content button:hover {
      background: #372fda;
      transform: translateY(-2px);
    }

    /* Ajuste para bot√£o copiar no modal senha */
    .copy-btn {
      margin-right: 10px;
    }

    @media (max-width: 600px) {
      body {
        padding: 15px 10px;
      }
      .container {
        padding: 20px 20px;
      }

      h1 {
        font-size: 1.8rem;
      }

      button[type="submit"] {
        max-width: 100%;
      }

      table, thead, tbody, th, td, tr {
        display: block;
        width: 100%;
      }

      thead tr {
        display: none;
      }

      tbody tr {
        margin-bottom: 15px;
        border-radius: 12px;
        box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        background: #fff;
        padding: 15px 15px 20px;
      }

      tbody tr:hover {
        background: #f0f3ff;
      }

      tbody td {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 0.95rem;
        border-bottom: 1px solid #eee;
      }

      tbody td:first-child {
        font-weight: 700;
        color: #4f46e5;
        max-width: none;
        white-space: normal;
        overflow: visible;
        flex-grow: 1;
        border-bottom: none;
      }

      .actions-cell {
        display: flex;
        justify-content: flex-start;
        gap: 10px;
        padding-top: 8px;
      }

      .actions-cell button {
        margin-right: 0;
        font-size: 22px;
        padding: 6px 10px;
      }
    }

  </style>
</head>
<body>

  <div class="container">
    <button id="btnVoltar" onclick="voltarDashboard()" aria-label="Voltar ao Dashboard">
      ‚Üê Voltar ao Dashboard
    </button>

    <h1>Gest√£o de Usu√°rios</h1>

    <form id="userForm">
      <input type="hidden" id="userIndex" value="-1" />
      
      <label for="nome">Nome do Usu√°rio:</label>
      <input type="text" id="nome" required placeholder="Digite o nome" />

      <label for="senha">Senha:</label>
      <div class="senha-wrapper">
        <input type="password" id="senha" required placeholder="Digite a senha" />
        <button type="button" class="toggle-olhinho-btn" aria-label="Visualizar senha" onclick="mostrarSenhaInputModal()">üëÅÔ∏è</button>
      </div>

      <label for="perfil">Perfil / Permiss√£o:</label>
      <select id="perfil" required>
        <option value="" disabled selected>Selecione um perfil</option>
        <option value="admin">Administrador</option>
        <option value="editor">Editor</option>
        <option value="visualizador">Visualizador</option>
      </select>

      <button type="submit">Salvar Usu√°rio</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Perfil</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <!-- Usu√°rios listados aqui -->
      </tbody>
    </table>
  </div>

  <!-- Modal para mostrar senha -->
  <div id="modalSenha" role="dialog" aria-modal="true" aria-labelledby="modalSenhaLabel">
    <div class="modal-content">
      <div id="modalSenhaDesc" tabindex="0"></div>
      <button class="copy-btn" onclick="copiarSenhaModal()">Copiar Senha</button>
      <button onclick="fecharModalSenha()">Fechar</button>
    </div>
  </div>

  <!-- Modal gen√©rico para alertas -->
  <div id="modalMensagem" role="alertdialog" aria-modal="true" aria-labelledby="modalMensagemTexto">
    <div class="modal-content">
      <div id="modalMensagemTexto" tabindex="0"></div>
      <button id="modalMensagemBtnOk">OK</button>
    </div>
  </div>

  <!-- Modal gen√©rico para confirma√ß√£o -->
  <div id="modalConfirm" role="dialog" aria-modal="true" aria-labelledby="modalConfirmTexto">
    <div class="modal-content">
      <div id="modalConfirmTexto" tabindex="0"></div>
      <button id="btnSim">Sim</button>
      <button id="btnNao">N√£o</button>
    </div>
  </div>

  <script>
    // Fun√ß√£o para gerar senha aleat√≥ria segura
    function gerarSenhaAleatoria(tamanho = 12) {
      const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+";
      let senha = "";
      for (let i = 0; i < tamanho; i++) {
        senha += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return senha;
    }

    // Pega elementos
    const userForm = document.getElementById('userForm');
    const nomeInput = document.getElementById('nome');
    const senhaInput = document.getElementById('senha');
    const perfilSelect = document.getElementById('perfil');
    const userTableBody = document.getElementById('userTableBody');
    const userIndexInput = document.getElementById('userIndex');

    // Modal senha
    const modalSenha = document.getElementById('modalSenha');
    const modalSenhaDesc = document.getElementById('modalSenhaDesc');

    // Modal mensagem (alert)
    const modalMensagem = document.getElementById('modalMensagem');
    const modalMensagemTexto = document.getElementById('modalMensagemTexto');
    const modalMensagemBtnOk = document.getElementById('modalMensagemBtnOk');

    // Modal confirma√ß√£o
    const modalConfirm = document.getElementById('modalConfirm');
    const modalConfirmTexto = document.getElementById('modalConfirmTexto');
    const btnSim = document.getElementById('btnSim');
    const btnNao = document.getElementById('btnNao');

    // Fun√ß√£o mostrar alerta com op√ß√£o de copiar senha
    function mostrarAlerta(msg, isSenha = false) {
      return new Promise(resolve => {
        modalMensagemTexto.textContent = msg;
        modalMensagem.style.display = 'flex';

        if (isSenha) {
          modalMensagemBtnOk.focus();
        }

        modalMensagemBtnOk.onclick = () => {
          modalMensagem.style.display = 'none';
          resolve();
        };
      });
    }



    

    // Fun√ß√£o mostrar confirma√ß√£o
    function mostrarConfirmacao(msg) {
      return new Promise(resolve => {
        modalConfirmTexto.textContent = msg;
        modalConfirm.style.display = 'flex';
        btnSim.focus();

        btnSim.onclick = () => {
          modalConfirm.style.display = 'none';
          resolve(true);
        };
        btnNao.onclick = () => {
          modalConfirm.style.display = 'none';
          resolve(false);
        };
      });
    }

    // LocalStorage e usu√°rios
    let usuarios = JSON.parse(localStorage.getItem('usuarios'));

    (async () => {
      if (!usuarios || usuarios.length === 0) {
        const senhaGerada = gerarSenhaAleatoria();
        usuarios = [{
          nome: "admin",
          senha: senhaGerada,
          perfil: "admin"
        }];
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        await mostrarAlerta(`Usu√°rio padr√£o criado:\n\nUsu√°rio: admin\nSenha: ${senhaGerada}\nPerfil: administrador`, true);
      }

      renderizarTabela();
    })();

    function salvarUsuarios() {
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
    }

    function limparFormulario() {
      userIndexInput.value = -1;
      nomeInput.value = '';
      senhaInput.value = '';
      perfilSelect.value = '';
      perfilSelect.selectedIndex = 0;
    }

    function renderizarTabela() {
      userTableBody.innerHTML = '';

      usuarios.forEach((user, index) => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td title="${user.nome}">${user.nome}</td>
          <td>${user.perfil}</td>
          <td class="actions-cell">
            <button class="edit-btn" title="Editar" onclick="editarUsuario(${index})">‚úèÔ∏è</button>
            <button class="view-pass-btn" title="Visualizar Senha" onclick="mostrarSenhaModal(${index})">üëÅÔ∏è</button>
            <button class="delete-btn" title="Excluir" onclick="excluirUsuario(${index})">üóëÔ∏è</button>
          </td>
        `;

        userTableBody.appendChild(tr);
      });
    }

    function copiarSenhaModal() {
      const textoCompleto = modalSenhaDesc.textContent;

      // Pega s√≥ a senha ap√≥s os dois pontos e espa√ßo ": "
      const senha = textoCompleto.split(': ')[1] || '';

      if (!senha) {
        alert('Nenhuma senha encontrada para copiar.');
        return;
      }

      navigator.clipboard.writeText(senha.trim()).then(() => {
        alert('Senha copiada para a √°rea de transfer√™ncia!');
      }).catch(() => {
        alert('Erro ao copiar senha.');
      });
    }

    
    function editarUsuario(index) {
      const user = usuarios[index];
      userIndexInput.value = index;
      nomeInput.value = user.nome;
      senhaInput.value = user.senha;
      perfilSelect.value = user.perfil;
    }

    async function excluirUsuario(index) {
      const confirmar = await mostrarConfirmacao(`Excluir usu√°rio "${usuarios[index].nome}"?`);
      if (confirmar) {
        usuarios.splice(index, 1);
        salvarUsuarios();
        renderizarTabela();
        limparFormulario();
      }
    }

    userForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const nome = nomeInput.value.trim();
      const senha = senhaInput.value.trim();
      const perfil = perfilSelect.value;

      if (!nome || !senha || !perfil) {
        await mostrarAlerta('Preencha todos os campos!');
        return;
      }

      const index = parseInt(userIndexInput.value);

      if (index === -1) {
        if (usuarios.some(u => u.nome.toLowerCase() === nome.toLowerCase())) {
          await mostrarAlerta('J√° existe um usu√°rio com esse nome!');
          return;
        }
        usuarios.push({ nome, senha, perfil });
      } else {
        usuarios[index] = { nome, senha, perfil };
      }

      salvarUsuarios();
      renderizarTabela();
      limparFormulario();
    });

    function mostrarSenhaModal(index) {
      const senha = usuarios[index].senha;
      modalSenhaDesc.textContent = `Senha: ${senha}`;
      modalSenha.style.display = 'flex';
      modalSenhaDesc.focus();
    }

    async function mostrarSenhaInputModal() {
      const senhaAtual = senhaInput.value;
      if (!senhaAtual) {
        await mostrarAlerta('Digite a senha para visualizar.');
        return;
      }
      modalSenhaDesc.textContent = `Senha digitada: ${senhaAtual}`;
      modalSenha.style.display = 'flex';
      modalSenhaDesc.focus();
    }

    function fecharModalSenha() {
      modalSenha.style.display = 'none';
    }

    function voltarDashboard() {
      window.location.href = 'dashboard.html';
    }

    // Expor fun√ß√µes para o escopo global
    window.editarUsuario = editarUsuario;
    window.excluirUsuario = excluirUsuario;
    window.mostrarSenhaModal = mostrarSenhaModal;
    window.mostrarSenhaInputModal = mostrarSenhaInputModal;
    window.fecharModalSenha = fecharModalSenha;
    window.copiarSenhaModal = copiarSenhaModal;

  </script> 
</body> 
</html>
