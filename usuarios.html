<!DOCTYPE html>
<html lang="pt-br" >
<head>
  <meta charset="UTF-8" />
  <title>Gest√£o de Usu√°rios</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * { box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 40px 20px;
      color: #333;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 720px;
      background: #fff;
      padding: 30px 40px;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(79, 70, 229, 0.15);
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    #btnVoltar {
      background: transparent;
      border: none;
      color: #4f46e5;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      padding: 8px 0;
      margin-bottom: 20px;
      align-self: flex-start;
    }
    #btnVoltar:hover {
      color: #372fda;
      text-decoration: underline;
    }

    h1 {
      margin: 0 0 10px;
      color: #4f46e5;
      font-weight: 700;
      font-size: 2.2rem;
      text-align: center;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #555;
    }

    input[type="text"], input[type="password"], select {
      padding: 12px 15px;
      border: 1.8px solid #ddd;
      border-radius: 12px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      width: 100%;
    }

    input:focus, select:focus {
      border-color: #4f46e5;
      outline: none;
    }

    .senha-wrapper {
      position: relative;
    }
    .senha-wrapper input { padding-right: 40px; }
    .toggle-olhinho-btn {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.3rem;
      color: #4f46e5;
    }

    button[type="submit"] {
      background: #4f46e5;
      color: white;
      padding: 14px 20px;
      font-weight: 700;
      font-size: 1.1rem;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4);
    }

    button[type="submit"]:hover {
      background: #4338ca;
      transform: translateY(-2px);
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 12px;
      font-size: 0.95rem;
      color: #444;
    }

    th {
      background: #4f46e5;
      color: white;
      padding: 14px 15px;
      text-align: left;
      border-radius: 12px 12px 0 0;
    }

    tbody tr {
      background: #fafafa;
      border-radius: 12px;
      transition: background 0.3s ease;
    }
    tbody tr:hover { background: #e9ecff; }

    td { padding: 14px 15px; }
    td:first-child { font-weight: 600; color: #2c2c2c; }
    .actions-cell { white-space: nowrap; }

    button.edit-btn, button.delete-btn, button.view-pass-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 20px;
      margin-right: 12px;
      border-radius: 8px;
      padding: 6px 10px;
      color: #4f46e5;
    }
    button.edit-btn:hover { background: #c7d3ff; }
    button.delete-btn:hover { background: #fbb6b6; color: #b91c1c; }
    button.view-pass-btn:hover { background: #c7d3ff; }

    /* Modais com estilo aprimorado */
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    #modalSenha, #modalMensagem, #modalConfirm {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }

    .modal-content {
      background: #fff;
      padding: 30px 25px;
      border-radius: 16px;
      width: 90%;
      max-width: 380px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
      text-align: center;
      font-size: 1.05rem;
      font-weight: 500;
      color: #2c2c2c;
      animation: fadeInScale 0.3s ease;
    }

    #modalSenha .modal-content::before { content: "\1F512"; }
    #modalMensagem .modal-content::before { content: "\1F4A1"; }
    #modalConfirm .modal-content::before { content: "\2753"; }
    .modal-content::before {
      font-size: 2.5rem;
      display: block;
      margin-bottom: 12px;
      color: #4f46e5;
    }

    .modal-content button {
      background: #4f46e5;
      color: white;
      padding: 12px 18px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1rem;
      margin: 10px 5px 0;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    #modalConfirm #btnSim {
      background: #22c55e;
    }
    #modalConfirm #btnSim:hover {
      background: #16a34a;
    }
    #modalConfirm #btnNao {
      background: #ef4444;
      color: white;
    }
    #modalConfirm #btnNao:hover {
      background: #dc2626;
    }

    .modal-content button:hover {
      background: #372fda;
      transform: translateY(-2px);
    }

    @media (max-width: 600px) {
      .container { padding: 20px; }
      table, th, td { font-size: 0.85rem; }
    }
  </style>
</head>
<body>

  <div class="container">
    <button id="btnVoltar" onclick="voltarDashboard()" aria-label="Voltar ao Dashboard">
      ‚Üê Voltar ao Dashboard
    </button>

    <h1>Gest√£o de Usu√°rios</h1>

    <form id="userForm">
      <input type="hidden" id="userIndex" value="-1" />
      
      <label for="nome">Nome do Usu√°rio:</label>
      <input type="text" id="nome" required placeholder="Digite o nome" />

      <label for="senha">Senha:</label>
      <div class="senha-wrapper">
        <input type="password" id="senha" required placeholder="Digite a senha" />
        <button type="button" class="toggle-olhinho-btn" aria-label="Visualizar senha" onclick="mostrarSenhaInputModal()">üëÅÔ∏è</button>
      </div>

      <label for="perfil">Perfil / Permiss√£o:</label>
      <select id="perfil" required>
        <option value="" disabled selected>Selecione um perfil</option>
        <option value="admin">Administrador</option>
        <option value="editor">Editor</option>
        <option value="visualizador">Visualizador</option>
      </select>

      <button type="submit">Salvar Usu√°rio</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Perfil</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <!-- Usu√°rios listados aqui -->
      </tbody>
    </table>
  </div>

  <!-- Modal para mostrar senha -->
  <div id="modalSenha">
    <div class="modal-content">
      <div id="modalSenhaDesc"></div>
      <button onclick="fecharModalSenha()">Fechar</button>
    </div>
  </div>

  <!-- Modal gen√©rico para alertas -->
  <div id="modalMensagem">
    <div class="modal-content">
      <div id="modalMensagemTexto"></div>
      <button id="modalMensagemBtnOk">OK</button>
    </div>
  </div>

  <!-- Modal gen√©rico para confirma√ß√£o -->
  <div id="modalConfirm">
    <div class="modal-content">
      <div id="modalConfirmTexto"></div>
      <button id="btnSim">Sim</button>
      <button id="btnNao">N√£o</button>
    </div>
  </div>

  <script>
    // Fun√ß√£o para gerar senha aleat√≥ria segura
    function gerarSenhaAleatoria(tamanho = 12) {
      const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+";
      let senha = "";
      for (let i = 0; i < tamanho; i++) {
        senha += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return senha;
    }

    // Pega elementos
    const userForm = document.getElementById('userForm');
    const nomeInput = document.getElementById('nome');
    const senhaInput = document.getElementById('senha');
    const perfilSelect = document.getElementById('perfil');
    const userTableBody = document.getElementById('userTableBody');
    const userIndexInput = document.getElementById('userIndex');

    // Modal senha
    const modalSenha = document.getElementById('modalSenha');
    const modalSenhaDesc = document.getElementById('modalSenhaDesc');

    // Modal mensagem (alert)
    const modalMensagem = document.getElementById('modalMensagem');
    const modalMensagemTexto = document.getElementById('modalMensagemTexto');
    const modalMensagemBtnOk = document.getElementById('modalMensagemBtnOk');

    // Modal confirma√ß√£o
    const modalConfirm = document.getElementById('modalConfirm');
    const modalConfirmTexto = document.getElementById('modalConfirmTexto');
const btnSim = document.getElementById('btnSim');
const btnNao = document.getElementById('btnNao');
function mostrarAlerta(msg) {
  return new Promise(resolve => {
    modalMensagemTexto.textContent = msg;
    modalMensagem.style.display = 'flex';
    modalMensagemBtnOk.onclick = () => {
      modalMensagem.style.display = 'none';
      resolve();
    };
  });
}

function mostrarConfirmacao(msg) {
  return new Promise(resolve => {
    modalConfirmTexto.textContent = msg;
    modalConfirm.style.display = 'flex';
    btnSim.onclick = () => {
      modalConfirm.style.display = 'none';
      resolve(true);
    };
    btnNao.onclick = () => {
      modalConfirm.style.display = 'none';
      resolve(false);
    };
  });
}

let usuarios = JSON.parse(localStorage.getItem('usuarios'));

(async () => {
  if (!usuarios || usuarios.length === 0) {
    const senhaGerada = gerarSenhaAleatoria();
    usuarios = [{
      nome: "admin",
      senha: senhaGerada,
      perfil: "admin"
    }];
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    await mostrarAlerta(`Usu√°rio padr√£o criado:\n\nUsu√°rio: admin\nSenha: ${senhaGerada}\nPerfil: administrador`);
  }

  renderizarTabela();
})();

function salvarUsuarios() {
  localStorage.setItem('usuarios', JSON.stringify(usuarios));
}

function limparFormulario() {
  userIndexInput.value = -1;
  nomeInput.value = '';
  senhaInput.value = '';
  perfilSelect.value = '';
  perfilSelect.selectedIndex = 0;
}

function renderizarTabela() {
  userTableBody.innerHTML = '';

  usuarios.forEach((user, index) => {
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td>${user.nome}</td>
      <td>${user.perfil}</td>
      <td class="actions-cell">
        <button class="edit-btn" title="Editar" onclick="editarUsuario(${index})">‚úèÔ∏è</button>
        <button class="view-pass-btn" title="Visualizar Senha" onclick="mostrarSenhaModal(${index})">üëÅÔ∏è</button>
        <button class="delete-btn" title="Excluir" onclick="excluirUsuario(${index})">üóëÔ∏è</button>
      </td>
    `;

    userTableBody.appendChild(tr);
  });
}

function editarUsuario(index) {
  const user = usuarios[index];
  userIndexInput.value = index;
  nomeInput.value = user.nome;
  senhaInput.value = user.senha;
  perfilSelect.value = user.perfil;
}

async function excluirUsuario(index) {
  const confirmar = await mostrarConfirmacao(`Excluir usu√°rio "${usuarios[index].nome}"?`);
  if (confirmar) {
    usuarios.splice(index, 1);
    salvarUsuarios();
    renderizarTabela();
    limparFormulario();
  }
}

userForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const nome = nomeInput.value.trim();
  const senha = senhaInput.value.trim();
  const perfil = perfilSelect.value;

  if (!nome || !senha || !perfil) {
    await mostrarAlerta('Preencha todos os campos!');
    return;
  }

  const index = parseInt(userIndexInput.value);

  if (index === -1) {
    if (usuarios.some(u => u.nome.toLowerCase() === nome.toLowerCase())) {
      await mostrarAlerta('J√° existe um usu√°rio com esse nome!');
      return;
    }
    usuarios.push({ nome, senha, perfil });
  } else {
    usuarios[index] = { nome, senha, perfil };
  }

  salvarUsuarios();
  renderizarTabela();
  limparFormulario();
});

function mostrarSenhaModal(index) {
  const senha = usuarios[index].senha;
  modalSenhaDesc.textContent = `Senha: ${senha}`;
  modalSenha.style.display = 'flex';
}

async function mostrarSenhaInputModal() {
  const senhaAtual = senhaInput.value;
  if (!senhaAtual) {
    await mostrarAlerta('Digite a senha para visualizar.');
    return;
  }
  modalSenhaDesc.textContent = `Senha digitada: ${senhaAtual}`;
  modalSenha.style.display = 'flex';
}

function fecharModalSenha() {
  modalSenha.style.display = 'none';
}

function voltarDashboard() {
  window.location.href = 'dashboard.html';
}

window.editarUsuario = editarUsuario;
window.excluirUsuario = excluirUsuario;
window.mostrarSenhaModal = mostrarSenhaModal;
window.mostrarSenhaInputModal = mostrarSenhaInputModal;
window.fecharModalSenha = fecharModalSenha;
</script> 
</body> 
</html>